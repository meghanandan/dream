import{r as s,R as L,j as e,aK as K,aL as M,ae as Y,bb as Z,aM as N,aP as G,n as m,h as x,w as P,cx as ae,v as o,cK as ne,az as te,aS as se,aT as re,aU as Q,aV as X,aW as ie,b7 as le,an as oe,cL as ce,T as U,U as de,b1 as ue,b2 as pe,ah as he,b6 as xe,ar as $,a9 as ge,cM as me,aa as fe,b8 as je,H as be,C as Ce}from"./index-cVH_xp6I.js";import{C as ye}from"./CheckCircle-DToQKj5Z.js";function ve({open:f,onClose:c}){const[g,j]=s.useState(null),[l,b]=s.useState(0),[p,h]=s.useState(""),[d,n]=s.useState(0),[i,C]=s.useState([]),[_,D]=s.useState([]),[W,O]=s.useState([]),[y,A]=s.useState([]),[I,T]=s.useState(0),[w,q]=s.useState(5);L.useEffect(()=>{f||(j(null),b(0),h(""),n(0),C([]),D([]),O([]),A([]),T(0))},[f]);const F=()=>{b(2),h(""),n(0);let t=0;const r=setInterval(()=>{t+=Math.random()*25,n(Math.min(t,100)),t>=100&&(clearInterval(r),b(3))},500)},a=t=>{h("");const r=t.target.files[0];if(r&&!r.name.endsWith(".csv")){h("Please select a CSV file."),j(null);return}j(r),ce.parse(r,{header:!0,skipEmptyLines:!0,complete:k=>{const E=k.meta.fields||[],ee=E.filter((B,H)=>E.indexOf(B)!==H);A([...new Set(ee)]),C(E),D(E.filter((B,H)=>E.indexOf(B)===H)),O(k.data),b(1)},error:()=>h("Error parsing CSV. Please try another file.")})},u=()=>{if(!g){h("No file selected.");return}b(2),F()},v=t=>{D(r=>r.includes(t)?r.filter(k=>k!==t):[...r,t])},S=(t,r)=>T(r),R=t=>{q(parseInt(t.target.value,10)),T(0)},V=()=>l===0?e.jsxs(P,{alignItems:"center",spacing:2,sx:{mt:2},children:[e.jsxs(x,{variant:"contained",component:"label",startIcon:e.jsx(ae,{}),sx:{fontWeight:700,fontSize:18,px:4,py:1.2},children:["Select CSV File",e.jsx("input",{type:"file",accept:".csv",hidden:!0,onChange:a})]}),e.jsx(o,{color:"text.secondary",children:"Please upload a single CSV file. Duplicate columns will be checked before upload."}),p&&e.jsx(o,{color:"error",children:p})]}):l===1?e.jsxs(m,{sx:{display:"flex",minHeight:380,maxHeight:480},children:[e.jsxs(m,{sx:{width:"20%",minWidth:160,borderRight:"1px solid #eee",pr:2,overflowY:"auto"},children:[e.jsx(o,{fontWeight:700,mb:1,children:"Columns"}),i.map(t=>e.jsx(ne,{control:e.jsx(te,{checked:_.includes(t),onChange:()=>v(t),disabled:y.includes(t)}),label:e.jsx("span",{style:y.includes(t)?{color:"#e53935"}:{},children:t}),sx:{display:"block",mb:.5}},t)),y.length>0&&e.jsxs(o,{color:"error",variant:"body2",mt:1,children:["Duplicates: ",y.join(", ")]})]}),e.jsxs(m,{sx:{flex:1,pl:3,display:"flex",flexDirection:"column"},children:[e.jsx(o,{fontWeight:700,mb:1,children:"Preview"}),e.jsx(m,{sx:{flex:1,overflow:"auto"},children:e.jsxs(se,{size:"small",stickyHeader:!0,children:[e.jsx(re,{children:e.jsx(Q,{children:_.map(t=>e.jsx(X,{children:t},t))})}),e.jsx(ie,{children:W.slice(I*w,I*w+w).map((t,r)=>e.jsx(Q,{children:_.map(k=>e.jsx(X,{children:t[k]},k))},r))})]})}),e.jsx(le,{component:"div",count:W.length,page:I,onPageChange:S,rowsPerPage:w,onRowsPerPageChange:R,rowsPerPageOptions:[5,10,20,50]}),p&&e.jsx(o,{color:"error",children:p})]})]}):l===2?e.jsxs(P,{alignItems:"center",spacing:2,sx:{mt:2},children:[e.jsxs(o,{children:["Uploading ",e.jsx("b",{children:g==null?void 0:g.name}),"..."]}),e.jsxs(m,{sx:{width:"80%",mt:2},children:[e.jsx(oe,{variant:"determinate",value:d}),e.jsxs(o,{align:"center",sx:{mt:1},children:[Math.round(d),"%"]})]})]}):l===3?e.jsxs(P,{alignItems:"center",spacing:2,sx:{mt:2},children:[e.jsx(o,{color:"success.main",variant:"h6",children:"CSV file uploaded and staged successfully!"}),e.jsx(x,{variant:"outlined",onClick:c,children:"Done"})]}):null;return e.jsxs(K,{open:f,onClose:(t,r)=>{r&&(r==="backdropClick"||r==="escapeKeyDown")||c()},maxWidth:"md",fullWidth:!0,disableEscapeKeyDown:!0,children:[e.jsxs(M,{sx:{fontWeight:700,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{children:"Upload CSV Data"}),e.jsx(Y,{onClick:c,size:"small",children:e.jsx(Z,{})})]}),e.jsx(N,{children:V()}),e.jsxs(G,{sx:{justifyContent:"space-between",px:3,pb:3},children:[e.jsx(m,{children:l===1&&e.jsx(x,{variant:"contained",color:"warning",onClick:u,disabled:y.length>0||_.length===0,sx:{fontWeight:700,px:3,boxShadow:"none",textTransform:"none",background:"#FFA726","&:hover":{background:"#FB8C00"}},children:"Validate and Upload"})}),e.jsx(m,{children:(l===0||l===1)&&e.jsx(x,{onClick:c,color:"inherit",sx:{fontWeight:700},children:"Cancel"})})]})]})}function J({open:f,onClose:c,schema:g,title:j,initialValues:l={},onSubmit:b}){const[p,h]=L.useState(l);L.useEffect(()=>{h(l)},[l,f]);const d=(n,i)=>h(C=>({...C,[n]:i}));return e.jsxs(K,{open:f,onClose:c,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{fontWeight:700,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{children:j}),e.jsx(Y,{onClick:c,size:"small",children:e.jsx(Z,{})})]}),e.jsx(N,{children:e.jsx(P,{spacing:2,mt:1,children:g.map(n=>n.type==="select"?e.jsx(U,{select:!0,fullWidth:!0,label:n.label,value:p[n.name]||"",onChange:i=>d(n.name,i.target.value),required:n.required,children:n.options.map(i=>e.jsx(de,{value:i.value,children:i.label},i.value))},n.name):n.type==="textarea"?e.jsx(U,{label:n.label,fullWidth:!0,multiline:!0,minRows:3,value:p[n.name]||"",onChange:i=>d(n.name,i.target.value)},n.name):e.jsx(U,{label:n.label,fullWidth:!0,value:p[n.name]||"",onChange:i=>d(n.name,i.target.value),required:n.required},n.name))})}),e.jsxs(G,{children:[e.jsx(x,{color:"inherit",onClick:c,children:"Cancel"}),e.jsx(x,{variant:"contained",onClick:()=>b(p),children:"Save"})]})]})}const z=[{id:1,external_api_code:"sf",api_name:"Salesforce",image:"/configuration/Salesforce.png",description:""},{id:2,external_api_code:"xc",api_name:"Xactly",image:"/configuration/Xactly.png",description:""},{id:3,external_api_code:"ql",api_name:"QuickBooks",image:"/configuration/quickbooks.png",description:""},{id:4,external_api_code:"hs",api_name:"HubSpot",image:"/configuration/hubspot.png",description:""},{id:5,external_api_code:"ca",api_name:"CaptivateIQ",image:"/configuration/captivateiq.png",description:""},{id:6,external_api_code:"ns",api_name:"Netsuite",image:"/configuration/netsuite.png",description:""},{id:7,external_api_code:"var",api_name:"Varicent",image:"/configuration/varicent.png",description:""}],Se=[{name:"name",label:"Connector Name",type:"text",required:!0},{name:"api_url",label:"API Endpoint URL",type:"text",required:!0},{name:"auth_type",label:"Authentication",type:"select",required:!0,options:[{value:"none",label:"None"},{value:"apikey",label:"API Key"},{value:"bearer",label:"Bearer Token"}]},{name:"api_key",label:"API Key (if needed)",type:"text"},{name:"bearer_token",label:"Bearer Token (if needed)",type:"text"}],ke=[{name:"name",label:"Webhook Name",type:"text",required:!0},{name:"event",label:"Event to Trigger",type:"select",required:!0,options:[{value:"create",label:"On Create"},{value:"update",label:"On Update"},{value:"delete",label:"On Delete"}]},{name:"webhook_url",label:"Webhook URL",type:"text",required:!0},{name:"secret",label:"Secret Key (optional)",type:"text"},{name:"payload_template",label:"Payload Template",type:"textarea"}];function _e(){const[f,c]=s.useState(!1),[g,j]=s.useState(null),[l,b]=s.useState(""),[p,h]=s.useState(null),[d,n]=s.useState([]),[i,C]=s.useState([]),_=ue.getJson("userData"),[D,W]=s.useState(!1),[O,y]=s.useState(!1),[A,I]=s.useState(!1),T=a=>{a.keys&&a.keys.length>0&&(j(a),n(a.keys),c(!0))};s.useEffect(()=>{w()},[]);const w=async()=>{try{const a={org_code:_.organization},u=await pe(he.external_api.api_form,"POST",a);if(u!=null&&u.status){const v={};(u.data||[]).forEach(S=>{v[S.external_api_code]=!0}),C(z.map(S=>{var R;return{...S,configured:!!v[S.external_api_code],keys:((R=(u.data||[]).find(V=>V.external_api_code===S.external_api_code))==null?void 0:R.keys)||[]}}))}else C(z)}catch{C(z)}},q=()=>{c(!1),j(null)},F=[e.jsx(je,{underline:"hover",color:"inherit",to:"/home",children:"Home"},"1"),e.jsx(o,{sx:{color:"text.primary"},children:"Connectors"},"3")];return e.jsxs(m,{sx:{px:3,py:2,minHeight:"100vh"},children:[e.jsx(P,{spacing:1,children:e.jsx(xe,{separator:"â€º","aria-label":"breadcrumb",children:F})}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap"},children:[e.jsx(o,{variant:"h4",gutterBottom:!0,children:"Connectors"}),e.jsxs(P,{direction:"row",spacing:2,children:[e.jsx(x,{variant:"contained",color:"primary",onClick:()=>y(!0),children:"Add new connector"}),e.jsx(x,{variant:"outlined",color:"primary",onClick:()=>W(!0),children:"Upload CSV data"})]})]}),e.jsx($,{container:!0,spacing:3,children:i.map(a=>e.jsx($,{item:!0,xs:12,sm:4,md:2,children:e.jsxs(ge,{onClick:()=>T(a),sx:{cursor:a.keys&&a.keys.length>0?"pointer":"default",position:"relative",height:"100%"},children:[a.configured&&e.jsx(ye,{sx:{color:me[500],position:"absolute",top:10,right:10,fontSize:30}}),e.jsxs(fe,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},children:[e.jsx("img",{alt:a.api_name,src:a.image,style:{maxWidth:"60%",objectFit:"contain",marginBottom:12},loading:"lazy",onError:u=>{u.target.style.opacity=0}}),e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:a.api_name})]})]})},a.external_api_code))}),e.jsxs(K,{open:f,onClose:q,maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{children:g?`Configure ${g.api_name}`:"Add Details"}),e.jsxs(N,{children:[d&&d.map(a=>e.jsx(U,{margin:"dense",fullWidth:!0,variant:"outlined",label:a.api_key_label,name:a.api_key,type:a.field_type||"text",value:a.value,onChange:u=>{d.forEach(v=>{v.api_key===a.api_key&&(v.value=u.target.value)}),n([...d])}},a.id)),l&&e.jsx(o,{variant:"body2",color:"error",sx:{mb:2},children:l})]}),e.jsxs(G,{children:[e.jsx(x,{onClick:q,children:"Cancel"}),e.jsx(x,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]}),e.jsx(J,{open:O,onClose:()=>y(!1),schema:Se,title:"Configure API Connector",initialValues:{},onSubmit:a=>{},loading:!1,error:null}),e.jsx(J,{open:A,onClose:()=>I(!1),schema:ke,title:"Configure Webhook",initialValues:{},onSubmit:a=>{},loading:!1,error:null}),e.jsx(ve,{open:D,onClose:()=>W(!1)})]})}const we={title:`API Configuration - ${Ce.site.name}`};function We(){return e.jsxs(e.Fragment,{children:[e.jsx(be,{children:e.jsxs("title",{children:[" ",we.title]})}),e.jsx(_e,{})]})}export{We as default};
