import{ao as ge,al as je,r as a,b1 as G,b2 as m,ah as b,j as e,n as i,w as me,b6 as be,v as c,aq as R,T as we,W as ke,aA as g,h,aD as J,an as ye,aR as Se,aS as ve,aT as Ce,aU as w,aV as r,aW as We,d as Pe,au as Ie,ae as A,aE as q,b9 as Te,aj as _e,aY as K,b7 as De,ba as Re,aG as Ae,aH as Le,aI as Oe,U as L,aF as Fe,bb as V,aK as Be,aL as Ee,aM as ze,aP as Ne,aZ as $e,b8 as He,H as Me,C as Ue}from"./index-cVH_xp6I.js";import{S as Ge}from"./Search-ZLUYPozw.js";function Je(){const u=ge(),O=je(),[k,Y]=a.useState(""),[y,Z]=a.useState(""),[x,S]=a.useState(0),[p,Q]=a.useState(10),[v,F]=a.useState(0),[C,B]=a.useState([]),[o,l]=a.useState(!1),[X,E]=a.useState(!1),[z,W]=a.useState(""),[ee,N]=a.useState(null),$=G.getJson("userData"),P=G.getJson("role_Permissions"),[se,te]=a.useState(!1),[ae,H]=a.useState(!1),[re,M]=a.useState(null),[I,d]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{j()},[x,k,p]);const f=a.useRef(null);a.useEffect(()=>(f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{S(0),Y(y.trim())},450),()=>f.current&&clearTimeout(f.current)),[y]),a.useEffect(()=>{if(P){const s=oe(P);te(s)}},[P]);const oe=s=>{var n;const t=s.find(D=>D.page_id===3);return((n=t==null?void 0:t.permissions)==null?void 0:n.approve)||!1},ne={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,borderRadius:2,p:3},j=async()=>{l(!0);const s={search_key:k,page_number:x+1,page_size:p,org_code:$.organization};try{const t=await m(b.auth.getWorkFlowList,"POST",s);t.data&&t.data.length>0?(B(t.data),F(Number(t.totalRecords)||0)):(B([]),F(0))}catch{d({open:!0,message:"Failed to fetch workflows",severity:"error"})}finally{l(!1)}},U=s=>O(s),le=(s,t)=>S(t),ie=s=>{Q(parseInt(s.target.value,10)),S(0)},ce=s=>{Z(s.target.value)},de=(s,t)=>{W(s),N(t),E(!0)},T=()=>{E(!1),W(""),N(null)},he=async()=>{const s={id:ee,status:z,created_by:$.user_id};try{l(!0),(await m(b.auth.getWorkStatus,"POST",s)).data&&(j(),T(),d({open:!0,message:"Workflow status updated",severity:"success"}))}catch{d({open:!0,message:"Failed to update status",severity:"error"})}finally{l(!1)}},ue=async(s,t)=>{const n={id:s,status:t,slug:"workflow"};try{l(!0),(await m(b.auth.changeStatus,"POST",n)).status&&j()}catch{d({open:!0,message:"Failed to change status",severity:"error"})}finally{l(!1)}},xe=s=>{M(s),H(!0)},_=()=>{H(!1),M(null)},pe=async()=>{const s={id:re};try{l(!0),(await m(b.auth.deleteWorkflow,"POST",s)).status&&(j(),_(),d({open:!0,message:"Workflow deleted",severity:"success"}))}catch{d({open:!0,message:"Failed to delete workflow",severity:"error"})}finally{l(!1)}},fe=[e.jsx(He,{underline:"hover",color:"inherit",to:"/home",children:"Home"},"1"),e.jsx(c,{sx:{color:"text.primary"},children:"Workflows"},"3")];return e.jsxs(i,{sx:{px:3,py:2,minHeight:"100vh"},children:[e.jsx(me,{spacing:1,children:e.jsx(be,{separator:"›","aria-label":"breadcrumb",children:fe})}),e.jsx(c,{variant:"h4",gutterBottom:!0,children:"Workflow"}),e.jsx(R,{sx:{mb:1,boxShadow:3,p:1},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(we,{label:"Search Workflow Name",size:"small",variant:"outlined",value:y,onChange:ce,placeholder:"Type to search...",sx:{width:{xs:"100%",sm:"50%",md:"30%"}},InputProps:{startAdornment:e.jsx(ke,{position:"start",children:e.jsx(Ge,{fontSize:"small"})})}}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(g,{title:"Create Workflow",children:e.jsx(h,{variant:"contained",sx:{backgroundColor:u.palette.primary.main,"&:hover":{backgroundColor:u.palette.primary.dark}},startIcon:e.jsx(J,{}),onClick:()=>U("/workflows/create"),children:"Create Workflow"})}),e.jsx(g,{title:"Workflow Library",children:e.jsx(h,{variant:"contained",sx:{backgroundColor:u.palette.primary.main,"&:hover":{backgroundColor:u.palette.primary.dark}},children:"Library"})})]})]})}),e.jsxs(R,{sx:{boxShadow:3,position:"relative"},children:[o&&e.jsx(ye,{sx:{position:"absolute",left:0,top:0,width:"100%",borderTopLeftRadius:4,borderTopRightRadius:4}}),e.jsx(Se,{component:R,children:e.jsxs(ve,{size:"small",children:[e.jsx(Ce,{children:e.jsxs(w,{children:[e.jsx(r,{children:"S.No"}),e.jsx(r,{children:"Name"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Stage"}),e.jsx(r,{children:"Archive"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(We,{children:o&&C.length===0?e.jsx(w,{children:e.jsxs(r,{colSpan:6,align:"center",sx:{py:6},children:[e.jsx(Pe,{size:26}),e.jsx(c,{variant:"body2",sx:{mt:1},color:"text.secondary",children:"Loading workflows..."})]})}):C.length>0?C.map((s,t)=>e.jsxs(w,{children:[e.jsx(r,{children:x*p+t+1}),e.jsx(r,{children:s.name?s.name.charAt(0).toUpperCase()+s.name.slice(1).toLowerCase():"--"}),e.jsx(r,{children:s.type?s.type.charAt(0).toUpperCase()+s.type.slice(1).toLowerCase():"--"}),e.jsx(r,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ie,{label:s.work_flow_status==="1"?"Pending":s.work_flow_status==="2"?"Approved":"Rejected",color:s.work_flow_status==="1"?"warning":s.work_flow_status==="2"?"success":"error",size:"small"}),se&&e.jsx(g,{title:"Edit Stage",children:e.jsx(A,{sx:{color:"primary.main"},onClick:()=>de(s.work_flow_status,s.id),children:e.jsx(q,{})})})]})}),e.jsx(r,{children:e.jsx(Te,{checked:s.status,onChange:n=>ue(s.id,n.target.checked),disabled:o})}),e.jsxs(r,{children:[e.jsx(g,{title:"Edit Workflow",children:e.jsx(A,{onClick:()=>O(_e.workflows.edit(s.id)),disabled:o,color:"primary",children:e.jsx(q,{})})}),e.jsx(g,{title:"Delete Workflow",children:e.jsx(A,{color:"error",onClick:()=>xe(s.id),disabled:o,children:e.jsx(K,{})})})]})]},s.id)):e.jsx(w,{children:e.jsxs(r,{colSpan:6,align:"center",sx:{py:6},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"No workflows found"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:2},children:k?"Try adjusting your search keywords.":"Get started by creating a new workflow."}),e.jsx(h,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>U("/workflows/create"),disabled:o,children:"Create Workflow"})]})})})]})}),e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,sx:{flexWrap:"wrap",gap:1},children:[e.jsx(c,{variant:"body2",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",flex:1},children:`Showing ${x*p+1} to ${Math.min((x+1)*p,v)} of ${v} entries`}),e.jsx(i,{sx:{flexShrink:0},children:e.jsx(De,{component:"div",count:v,page:x,onPageChange:le,rowsPerPage:p,onRowsPerPageChange:ie,rowsPerPageOptions:[10,20,30,40],labelDisplayedRows:({from:s,to:t,count:n})=>`${s}–${t} of ${n!==-1?n:`more than ${t}`}`,showFirstButton:!0,showLastButton:!0})})]})]}),e.jsx(Re,{open:X,onClose:T,"aria-labelledby":"modal-status-title","aria-describedby":"modal-status-description",children:e.jsxs(i,{sx:ne,children:[e.jsx(c,{id:"modal-status-title",variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Workflow Status"}),e.jsxs(Ae,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Le,{id:"status-select-label",children:"Select Status *"}),e.jsxs(Oe,{labelId:"status-select-label",value:z,label:"Select Status *",onChange:s=>W(s.target.value),children:[e.jsx(L,{value:"1",children:"Pending"}),e.jsx(L,{value:"2",children:"Approve"}),e.jsx(L,{value:"0",children:"Reject"})]})]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(h,{variant:"contained",startIcon:e.jsx(Fe,{}),fullWidth:!0,onClick:he,disabled:o,sx:{backgroundColor:u.palette.primary.main,"&:hover":{backgroundColor:u.palette.primary.dark}},children:"Save"}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(V,{}),fullWidth:!0,onClick:T,disabled:o,children:"Cancel"})]})]})}),e.jsxs(Be,{open:ae,onClose:_,"aria-labelledby":"delete-dialog-title",maxWidth:"xs",fullWidth:!0,children:[e.jsx(Ee,{id:"delete-dialog-title",children:"Delete Workflow"}),e.jsx(ze,{children:e.jsx(c,{variant:"body2",children:"Are you sure you want to delete this workflow? This action cannot be undone."})}),e.jsxs(Ne,{children:[e.jsx(h,{onClick:_,disabled:o,startIcon:e.jsx(V,{}),children:"Cancel"}),e.jsx(h,{onClick:pe,color:"error",variant:"contained",disabled:o,startIcon:e.jsx(K,{}),children:"Delete"})]})]}),e.jsx($e,{open:I.open,autoHideDuration:2500,onClose:()=>d({...I,open:!1}),message:I.message,anchorOrigin:{vertical:"top",horizontal:"right"}})]})}const qe={title:`Workflows - ${Ue.site.name}`};function Ye(){return e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:e.jsxs("title",{children:[" ",qe.title]})}),e.jsx(Je,{})]})}export{Ye as default};
