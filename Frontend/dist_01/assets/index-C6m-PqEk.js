import{K as D,ao as ve,al as fe,r as l,b1 as _e,b2 as z,ah as M,j as e,T as oe,aG as q,aI as R,U as g,Z as K,aK as be,aL as je,aM as Se,v as J,n as m,cN as we,aP as ke,aH as H,h as me,aZ as De,ab as Ce,w as Te,b6 as Pe,aq as he,d as Ae,aR as Ie,aS as Oe,aT as qe,aU as xe,aV as ye,aW as Re,ae as Ve,b7 as Ee,P as ze,ax as Me,ay as We,cX as Ne,V as Le,b8 as Fe,H as Ye,C as $e}from"./index-cVH_xp6I.js";import{T as Be}from"./TouchApp-9PRo3SF3.js";import{c as He,b as Je,a as ge}from"./index.esm-DW-FEPUt.js";import{D as de}from"./index-DPZk-k-v.js";He().shape({orderId:ge().required("Order ID is required"),disputeReason:ge().required("Dispute reason is required"),disputeAmount:Je().typeError("Dispute amount must be a number").positive("Amount must be positive").required("Dispute amount is required")});D.bool.isRequired,D.func.isRequired,D.func.isRequired,D.shape({orderId:D.string,disputeReason:D.string,disputeAmount:D.number});const Ke=({open:b,onClose:W,workFlowId:G,templateId:j,orderId:V,templateType:N})=>{const L=ve(),U=fe(),[S,x]=l.useState([]),[F,v]=l.useState([]),[Z,h]=l.useState([]),[y,d]=l.useState(null),f=_e.getJson("userData"),[C,Y]=l.useState(!1),[i,$]=l.useState(null),[w,E]=l.useState(""),[T,Q]=l.useState(""),[P,X]=l.useState(""),[A,ee]=l.useState(""),[I,B]=l.useState({disputeType:[],disputeReason:[],priority:[],severity:[]});l.useEffect(()=>{b&&te()},[b]);const te=async()=>{try{const a=await z(M.auth.getQuickCodeListForDisputes,"GET");console.log("Dropdown API response:",a),a&&B({disputeType:a.disputeType||[],disputeReason:a.disputeReason||[],priority:a.priority||[],severity:a.severity||[]})}catch{B({disputeType:[],disputeReason:[],priority:[],severity:[]}),d({severity:"error",message:"Failed to load dropdown options."})}};l.useEffect(()=>{V&&j&&se()},[V,j]);const se=async()=>{var a;try{const s={order_id:V,template_id:j,org_code:f.organization,user_id:f.user_id,type:"0"},t=await z(M.auth.raiseDispute,"POST",s);if((a=t==null?void 0:t.data)!=null&&a.fields){$(t.data);const r=t.data.fields.map(u=>({...u,is_negative:!1,value:u.required&&(u.value===null||u.value==="")?"UNKNOWN":u.value||""})),p=[...r.reduce((u,o)=>{const _=o.name;if(!u.has(_)&&!o.viewonly)u.set(_,{id:o.id,name:o.name,label:o.label,viewonly:o.viewonly,element:o.element,oldValue:o.value||"",newValue:o.value||"",required:o.required,disable:o.disable});else if(u.has(_)&&!o.viewonly){const c=u.get(_);o.disable?c.oldValue=o.value||"":c.newValue=o.value||""}return u},new Map).values()];x(r),v(p),h(r)}else x([]),v([]),h([]),d({severity:"warning",message:"No dispute templates found."})}catch(s){console.error("Error fetching dispute templates:",s),d({severity:"error",message:"Failed to fetch dispute templates."})}},O=(a,s)=>{const t=S.map(n=>n.name===a&&n.label==="Amount"&&!n.disable?{...n,value:s,is_negative:!1}:n),r=F.map(n=>n.name===a&&n.label==="Amount"?{...n,newValue:s}:n);x(t),v(r)},ae=a=>a.filter(s=>{const t=S.find(r=>r.id===s.id&&s.field_id===void 0);return t&&s.value!==t.value}).map(s=>{const t=S.find(r=>r.id===s.id&&s.field_id===void 0);return{...s,is_negative:s.value<t.value,visible:!1}}),ne=async()=>{Y(!0);try{if(!w||!T||!P||!A){d({severity:"error",message:"Please select all dispute dropdowns before submitting."});return}const a=S.find(c=>c.label==="Amount"&&c.required);if(a&&(a.value===null||a.value==="")){d({severity:"error",message:"Please fill in the required Amount field."});return}const s=ae(Z),t=[...S,...s],r=a.value,n=()=>{if(f.licence_type)return f.licence_type;if(i!=null&&i.licence_type)return i.licence_type;const c=t.find(k=>k.name==="licence_type"||k.name==="license_type");return(c==null?void 0:c.value)||null},p=()=>{if(i!=null&&i.dream_lite_source_data)return i.dream_lite_source_data;if(i!=null&&i.source_data)return i.source_data;const c=t.find(k=>k.name==="dream_lite_source_data"||k.name==="source_data");return(c==null?void 0:c.value)||i||null},u=()=>i!=null&&i.dream_lite_modified_data?i.dream_lite_modified_data:t.length>0?t:null,o={org_code:f.organization,work_flow_id:G,template_id:j,template_type:1,created_by:f.user_id,fields:t,dispute_type:w,description:T,priority:P,severity:A,getAmount:r,licence_type:n(),dream_lite_source_data:p(),dream_lite_modified_data:u()};console.log("🔍 Extracted dispute data:",{licence_type:n(),dream_lite_source_data:p()?"Present":"Null",dream_lite_modified_data:u()?"Present":"Null",originalDisputeData:i?"Available":"Not Available"});const _=await z(M.auth.createDispute,"POST",o);_.status?(d({severity:"success",message:"Dispute created successfully."}),U("/disputes"),x([]),v([]),h([]),W()):d({severity:"error",message:_.message||"Failed to create dispute."})}catch(a){console.error("Error creating dispute:",a),d({severity:"error",message:"An unexpected error occurred."})}},re=l.useMemo(()=>[{title:"Existing Value",dataIndex:"oldValue",key:"oldValue",render:(a,s)=>{var t;return(s.element==="input"||s.element==="text"||s.element==="number")&&!s.viewonly?e.jsx(oe,{fullWidth:!0,size:"small",label:s.label,value:s.oldValue,disabled:!0}):s.element==="select"&&!s.viewonly?e.jsx(q,{fullWidth:!0,children:e.jsx(R,{size:"small",value:s.oldValue,disabled:!0,children:(t=s.options)==null?void 0:t.map(r=>e.jsx(g,{value:r,children:r},r))})}):s.element==="date"&&!s.viewonly?e.jsx(de,{size:"small",value:K(s.oldValue),disabled:!0}):s.oldValue||"-"}},{title:"New Value",dataIndex:"newValue",key:"newValue",render:(a,s)=>{var r;const t=s.label==="Amount";return(s.element==="input"||s.element==="text"||s.element==="number")&&!s.viewonly?e.jsx(oe,{fullWidth:!0,size:"small",label:s.label,value:s.newValue,onChange:n=>O(s.name,n.target.value),disabled:!t||s.disable}):s.element==="select"&&!s.viewonly?e.jsx(q,{fullWidth:!0,children:e.jsx(R,{size:"small",value:s.newValue,onChange:n=>O(s.name,n.target.value),disabled:!t,children:(r=s.options)==null?void 0:r.map(n=>e.jsx(g,{value:n,children:n},n))})}):s.element==="date"&&!s.viewonly?e.jsx(de,{size:"small",value:K(s.newValue),onChange:n=>O(s.name,n==null?void 0:n.format("YYYY-MM-DD")),disabled:!t}):s.newValue||"-"}}],[O]),le=F.filter(a=>!a.viewonly).map((a,s)=>({...a,s_no:s+1}));return e.jsxs(be,{open:b,fullWidth:!0,maxWidth:"md",children:[e.jsx(je,{children:"Sales Commission Dispute Form"}),e.jsxs(Se,{dividers:!0,children:[e.jsx(J,{variant:"body2",sx:{mb:0},children:"Please review the pre-filled information and edit the Amount field as needed."}),e.jsx(m,{component:"form",sx:{mx:"auto",mt:1},children:e.jsx(we,{columns:re,dataSource:le,rowKey:"id",pagination:!1,rowClassName:(a,s)=>s%2===0?"table-row-white":"table-row-gray",className:"custom-table"})})]}),e.jsx(ke,{sx:{p:2},children:e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsxs(m,{children:[e.jsx(H,{shrink:!0,sx:{mb:0},children:"Dispute Type"}),e.jsx(q,{size:"small",sx:{minWidth:140},error:C&&!w,children:e.jsxs(R,{value:w,onChange:a=>E(a.target.value),displayEmpty:!0,children:[e.jsx(g,{value:"",disabled:!0,children:"-- Select --"}),I.disputeType.map(a=>e.jsx(g,{value:a.quick_code_type,children:a.quick_code_desc},a.quick_code_type))]})})]}),e.jsxs(m,{children:[e.jsx(H,{shrink:!0,sx:{mb:0},children:"Dispute Reason"}),e.jsx(q,{size:"small",sx:{minWidth:170},error:C&&!T,children:e.jsxs(R,{value:T,onChange:a=>Q(a.target.value),displayEmpty:!0,children:[e.jsx(g,{value:"",disabled:!0,children:"-- Select --"}),I.disputeReason.map(a=>e.jsx(g,{value:a.quick_code_type,children:a.quick_code_desc},a.quick_code_type))]})})]}),e.jsxs(m,{children:[e.jsx(H,{shrink:!0,sx:{mb:0},children:"Priority"}),e.jsx(q,{size:"small",sx:{minWidth:120},error:C&&!P,children:e.jsxs(R,{value:P,onChange:a=>X(a.target.value),displayEmpty:!0,children:[e.jsx(g,{value:"",disabled:!0,children:"-- Select --"}),I.priority.map(a=>e.jsx(g,{value:a.quick_code_type,children:a.quick_code_desc},a.quick_code_type))]})})]}),e.jsxs(m,{children:[e.jsx(H,{shrink:!0,sx:{mb:0},children:"Severity"}),e.jsx(q,{size:"small",sx:{minWidth:120},error:C&&!A,children:e.jsxs(R,{value:A,onChange:a=>ee(a.target.value),displayEmpty:!0,children:[e.jsx(g,{value:"",disabled:!0,children:"-- Select --"}),I.severity.map(a=>e.jsx(g,{value:a.quick_code_type,children:a.quick_code_desc},a.quick_code_type))]})})]})]}),e.jsxs(m,{sx:{display:"flex",gap:1},children:[e.jsx(me,{onClick:ne,variant:"contained",sx:{backgroundColor:L.palette.primary.main,"&:hover":{backgroundColor:L.palette.primary.dark}},children:"Create"}),e.jsx(me,{onClick:W,variant:"outlined",children:"Cancel"})]})]})}),e.jsx(De,{open:!!y,autoHideDuration:6e3,onClose:()=>d(null),children:e.jsx(Ce,{severity:y==null?void 0:y.severity,onClose:()=>d(null),children:y==null?void 0:y.message})})]})},{RangePicker:Ge}=de;function Ue(){ve();const b=_e.getJson("userData"),[W,G]=l.useState([]),[j,V]=l.useState([]),[N,L]=l.useState(0),[U,S]=l.useState([]),[x,F]=l.useState([K().startOf("month"),K().endOf("month")]),[v,Z]=l.useState(""),[h,y]=l.useState(1),[d,f]=l.useState(10),[C,Y]=l.useState(!1),[i,$]=l.useState(!1),[w,E]=l.useState(null),[T,Q]=l.useState(""),[P,X]=l.useState(""),[A,ee]=l.useState(""),[I,B]=l.useState("");l.useEffect(()=>{te()},[]),l.useEffect(()=>{se()},[v,x,h,d]);const te=l.useCallback(async()=>{try{const t=JSON.parse(localStorage.getItem("userData")),n=JSON.parse(localStorage.getItem("licencePROList")).map(u=>u.template_id),p=await z(M.auth.getDisputeorAdjustmentDropDown,"POST",{search_key:"",type:null,org_code:t.organization,template_ids:n});Array.isArray(p.data)&&S(p.data)}catch(t){console.error("Error fetching dispute adjustments:",t)}},[]),se=l.useCallback(async()=>{var t,r;Y(!0);try{const n={org_code:b.organization,user_id:b.user_id,type:1,search_key:v,from:(t=x[0])==null?void 0:t.format("YYYY-MM-DD"),to:(r=x[1])==null?void 0:r.format("YYYY-MM-DD"),page_size:d,page_number:h},p=await z(M.external_api.getOrdersData,"POST",n);if(p.status&&Array.isArray(p.rows)){const u=p.rows.map((c,k)=>{const ce=pe=>{if(!pe)return null;const ie=new Date(pe);return`${(ie.getMonth()+1).toString().padStart(2,"0")}/${ie.getDate().toString().padStart(2,"0")}/${ie.getFullYear()}`};return{...c,s_no:(h-1)*d+k+1,date:ce(c.date),incentive_date:ce(c.incentive_date)}});G(u),L(p.count);const o=Array.isArray(p.headers)?[...p.headers]:[],_=[{key:"s_no",label:"S.No"},...o,{key:"action",label:"Action"}];V(_)}}catch(n){console.error("Error fetching orders:",n)}finally{Y(!1)}},[v,x,h,d,b]),O=(t,r)=>{console.log(t),console.log(r),Q(r),E(t.currentTarget)},ae=()=>E(null),ne=(t,r,n)=>()=>{X(t),ee(r),B(n),$(!0),E(null)},re=t=>F(t),ue=t=>Z(t.target.value),le=(t,r)=>y(r+1),a=t=>{f(parseInt(t.target.value,10)),y(1)},s=[e.jsx(Fe,{underline:"hover",color:"inherit",to:"/home",children:"Home"},"1"),e.jsx(J,{sx:{color:"text.primary"},children:"Data"},"3")];return e.jsxs(m,{sx:{px:3,py:2},children:[e.jsx(Te,{spacing:1,children:e.jsx(Pe,{separator:"›","aria-label":"breadcrumb",children:s})}),e.jsx(J,{variant:"h4",gutterBottom:!0,children:"Data"}),e.jsx(he,{sx:{mb:1,boxShadow:3,p:1},children:e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:2,children:[e.jsx(oe,{label:"Search",size:"small",value:v,onChange:ue,sx:{width:"30%"}}),e.jsx(Ge,{value:x,onChange:re})]})}),e.jsx(he,{sx:{boxShadow:3},children:C?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",height:"100px",children:e.jsx(Ae,{})}):e.jsxs(m,{children:[e.jsx(Ie,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(qe,{children:e.jsx(xe,{children:j.map(t=>e.jsx(ye,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:t.label},t.key))})}),e.jsx(Re,{children:W.map(t=>e.jsx(xe,{children:j.map(r=>e.jsx(ye,{children:r.key==="action"?e.jsx(Ve,{onClick:n=>O(n,t.prod_orders_row_id),"aria-label":"open actions",children:e.jsx(Be,{})}):t[r.key]!==null&&t[r.key]!==void 0?t[r.key]:"-"},r.key))},t.prod_orders_row_id))})]})}),e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,sx:{flexWrap:"wrap",gap:1},children:[e.jsx(J,{variant:"body2",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",flex:1},children:`Showing data ${(h-1)*d+1} to ${Math.min(h*d,N)} of ${N}`}),e.jsx(m,{sx:{flexShrink:0},children:e.jsx(Ee,{component:"div",count:N,page:h-1,onPageChange:le,rowsPerPage:d,onRowsPerPageChange:a,rowsPerPageOptions:[10,20,30,40]})})]})]})}),e.jsx(ze,{open:!!w,anchorEl:w,onClose:ae,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Me,{children:U.map(t=>e.jsx(We,{disablePadding:!0,children:e.jsx(Ne,{onClick:ne(t.id,t.work_flow_id,t.template_type),dense:!0,children:e.jsx(Le,{primary:t.name})})},t.id))})}),e.jsx(Ke,{open:i,workFlowId:A,templateId:P,orderId:T,onClose:()=>$(!1),templateType:I})]})}const Ze={title:`Data - ${$e.site.name}`};function st(){return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{children:e.jsxs("title",{children:[" ",Ze.title]})}),e.jsx(Ue,{})]})}export{st as default};
