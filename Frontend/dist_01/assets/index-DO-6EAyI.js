import{j as e,ba as se,n as x,ae as H,bb as N,v as c,r as a,b1 as te,ao as Xe,ar as w,aG as Q,aH as fe,aI as je,U as O,T as be,h as M,aF as _e,aK as ye,aL as Se,aM as ke,aP as De,af as Z,b2 as z,ah as F,cy as es,au as X,D as ss,w as Ce,aS as ve,aT as Pe,aU as Y,aV as v,aW as we,ac as Me,aq as ee,Z as B,b6 as ts,b8 as ns,bs as rs,bt as xe,M as as,aR as is,a_ as os,b7 as ls,H as cs,C as ds}from"./index-cVH_xp6I.js";import{S as us,a as hs,b as xs}from"./Stepper-BJowDoal.js";import{D as gs}from"./index-DPZk-k-v.js";const ps=({open:r,onClose:n,history:s=[]})=>e.jsx(se,{open:r,onClose:n,children:e.jsxs(x,{sx:{p:4,bgcolor:"white",width:"90%",maxWidth:500,mx:"auto",mt:10,borderRadius:2,boxShadow:3,position:"relative",color:"black"},children:[e.jsx(H,{sx:{position:"absolute",top:8,right:8,color:"black"},onClick:n,children:e.jsx(N,{})}),e.jsx(c,{variant:"h6",sx:{textAlign:"center",mb:2},children:"Dispute Status"}),e.jsx(x,{sx:{maxHeight:400,overflowY:"auto"},children:s.length>0?e.jsx(us,{orientation:"vertical",children:s.map((l,m)=>e.jsx(hs,{active:m===s.length-1,completed:!!l.done_by,children:e.jsxs(xs,{children:[e.jsx(c,{variant:"subtitle1",sx:{fontWeight:"bold",color:"#1976D2"},children:`Step ${l.step_no||m+1}: ${l.dispute_stage||l.action||"No Status"}`}),e.jsxs(c,{sx:{fontSize:"14px"},children:[e.jsx("strong",{children:"User:"})," ",l.created_by||l.done_by_name||"Unknown"]}),e.jsxs(c,{sx:{fontSize:"14px"},children:[e.jsx("strong",{children:"Assigned To:"})," ",l.present_at||l.assigned_to_name||"N/A"]}),e.jsxs(c,{sx:{fontSize:"14px"},children:[e.jsx("strong",{children:"Date:"})," ",l.submitted_time||"N/A"]}),l.action&&e.jsxs(c,{sx:{fontSize:"14px"},children:[e.jsx("strong",{children:"Action:"})," ",l.action]})]})},m))}):e.jsx(c,{sx:{textAlign:"center",mt:2,color:"gray"},children:"No history available."})})]})}),ms=Z.object({comments:Z.string().min(1,"Comments is required"),decision:Z.string().min(1,"Dispute Status is required")}),fs=({open:r,onClose:n,onSave:s,getDisputID:l,getWorkFlowID:m,getNodeID:W,rowData:o,selectedRows:f})=>{const[d,D]=a.useState(""),[j,u]=a.useState(""),[I,P]=a.useState(!1),[C,b]=a.useState(""),[p,$]=a.useState(""),E=te.getJson("userData"),T=Xe(),V=()=>{const S={dispute_id:l,work_flow_id:m,done_by:E.user_id,org_code:E.organization,decision:d,comments:j,nodeId:W},R=ms.safeParse(S);if(!R.success){$(R.error.issues[0].message);return}try{z(F.auth.updateDispute,"POST",S).then(k=>{k.status?(D(""),u(""),b(k.message),P(!0),s==null||s()):console.log("No data found.")}).catch(k=>{console.error("Error while fetching master pages:",k)})}catch(k){console.error("Error while adding cluster:",k.response.data.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:r,onClose:n,children:e.jsxs(x,{sx:{p:4,bgcolor:"white",width:500,mx:"auto",mt:10,borderRadius:2,boxShadow:3,position:"relative",color:"black"},children:[e.jsx(H,{sx:{position:"absolute",top:8,right:8,color:"black"},onClick:n,children:e.jsx(N,{})}),e.jsx(c,{variant:"h6",sx:{textAlign:"center",mb:2},children:"Dispute Status"}),p&&e.jsx(c,{variant:"body2",color:"error",sx:{mb:2},children:p}),e.jsxs(w,{container:!0,spacing:2,children:[e.jsx(w,{item:!0,xs:12,children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(fe,{children:"Select Status "}),e.jsxs(je,{value:d,onChange:S=>D(S.target.value),children:[e.jsx(O,{value:"approved",children:"Approved"}),e.jsx(O,{value:"Rejected",children:"Rejected"})]})]})}),e.jsx(w,{item:!0,xs:12,children:e.jsx(Q,{fullWidth:!0,children:e.jsx(be,{"aria-label":"minimum height",minRows:3,placeholder:"Enter comments",value:j,onChange:S=>u(S.target.value)})})}),e.jsxs(w,{item:!0,xs:12,display:"flex",justifyContent:"space-between",children:[e.jsx(M,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:V,sx:{flex:1,mr:1,backgroundColor:T.palette.primary.main,"&:hover":{backgroundColor:T.palette.primary.dark}},children:"Save"}),e.jsx(M,{variant:"outlined",startIcon:e.jsx(N,{}),sx:{flex:1},onClick:n,children:"Cancel"})]})]})]})}),e.jsxs(ye,{open:I,onClose:()=>P(!1),children:[e.jsx(Se,{children:"Success"}),e.jsx(ke,{children:C}),e.jsx(De,{children:e.jsx(M,{onClick:()=>{P(!1),n()},color:"primary",children:"OK"})})]})]})},js=({open:r,onClose:n,onSave:s,users:l,selectedRows:m,rowData:W,userId:o})=>{const[f,d]=a.useState(!1),[D,j]=a.useState(""),[u,I]=a.useState(""),P=te.getJson("userData"),C=()=>{const b={dispute_ids:m,done_by:P.user_id,assigned_to:u,assigned_from:o};try{z(F.auth.performDelegation,"POST",b).then(p=>{p.status?(I(""),j(p.message),d(!0),s==null||s()):console.log("No data found.")}).catch(p=>{console.error("Error while fetching master pages:",p)})}catch(p){console.error("Error while adding cluster:",p.response.data.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:r,onClose:n,children:e.jsxs(x,{sx:{p:4,bgcolor:"white",width:500,mx:"auto",mt:10,borderRadius:2,boxShadow:3,position:"relative",color:"black"},children:[e.jsx(H,{sx:{position:"absolute",top:8,right:8,color:"black"},onClick:n,children:e.jsx(N,{})}),e.jsx(c,{variant:"h6",sx:{textAlign:"center",mb:2},children:"Delegation"}),e.jsxs(w,{container:!0,spacing:2,children:[e.jsx(w,{item:!0,xs:12,children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(fe,{children:"Select Users "}),e.jsx(je,{value:u,onChange:b=>I(b.target.value),children:l.map(b=>e.jsx(O,{value:b.id,children:b.name}))})]})}),e.jsxs(w,{item:!0,xs:12,display:"flex",justifyContent:"space-between",children:[e.jsx(M,{variant:"contained",startIcon:e.jsx(_e,{}),sx:{flex:1,mr:1},onClick:C,children:"Save"}),e.jsx(M,{variant:"outlined",startIcon:e.jsx(N,{}),sx:{flex:1},onClick:n,children:"Cancel"})]})]})]})}),e.jsxs(ye,{open:f,onClose:()=>d(!1),children:[e.jsx(Se,{children:"Success"}),e.jsx(ke,{children:D}),e.jsx(De,{children:e.jsx(M,{onClick:()=>{d(!1),n()},color:"primary",children:"OK"})})]})]})},ge=(r,n)=>{const s=r==null?void 0:r.find(l=>l.key===n);return s&&s.label?s.label:n.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())},bs="https://dream.uniflo.ai/api/api/auth/uploads/",pe=r=>{if(!r)return"";const n=r.replace(/\\/g,"/").split("/"),s=n[n.length-1];return`${bs}${s}`},_s=r=>{try{return Array.isArray(r.dream_lite_source_data)?r.dream_lite_source_data:typeof r.dream_lite_source_data=="string"?JSON.parse(r.dream_lite_source_data):[]}catch{return[]}},ys=r=>Array.isArray(r.dream_lite_modified_data)?r.dream_lite_modified_data:[],me=r=>r.reduce((n,s)=>(n[s.label]=s.value,n),{}),Ss=({open:r,onClose:n,drawerRowData:s,columns:l})=>{const m=["dispute_date"],W=(o,f)=>{const d=(f||"").toLowerCase();return o==="priority"?d==="high"?"error":d==="medium"?"warning":"info":o==="severity"?d==="major"||d==="critical"?"error":"info":o==="dispute_status"?d==="raised"?"warning":d==="resolved"||d==="approved"?"success":d==="rejected"?"error":"default":"default"};return console.log(s),e.jsx(es,{anchor:"right",open:r,onClose:n,children:e.jsxs(x,{sx:{width:450,p:3,bgcolor:"#f7fafc",height:"100vh",overflowY:"auto"},children:[e.jsxs(c,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:["Dispute Details for dispute id:",e.jsx(X,{label:s==null?void 0:s.dispute_id,color:"primary",size:"small",sx:{fontWeight:600,fontSize:16,height:28,color:"#fff"}})]}),e.jsx(ss,{sx:{mb:1}}),s&&e.jsxs(e.Fragment,{children:[m.map(o=>s[o]&&e.jsxs(x,{sx:{mb:0},children:[e.jsxs(c,{component:"span",sx:{fontWeight:600,fontSize:"0.85rem"},children:[ge(l,o),":"]}),e.jsx(c,{component:"span",sx:{ml:.5,fontSize:"0.85rem"},children:s[o]})]},o)),e.jsx(Ce,{direction:"row",spacing:2,sx:{my:1},children:["description","priority","severity","dispute_status"].map(o=>s[o]&&e.jsxs(x,{sx:{minWidth:80},children:[e.jsx(c,{sx:{fontWeight:400,textAlign:"center",fontSize:"0.85rem",mb:0},children:ge(l,o)}),e.jsx(X,{label:s[o],color:o==="description"?"default":W(o,s[o]),size:"small",sx:{textTransform:"capitalize",fontWeight:600,background:o==="description"?"#23272a":void 0,color:o==="description"?"#fff":void 0,minWidth:100,justifyContent:"center",fontSize:10,borderRadius:"10px"}})]},o))}),s.licence_type==="DREAMLTE"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{sx:{mt:2},children:[e.jsx(c,{sx:{fontWeight:600,mb:1},children:"Dream Lite Source & Modified Data"}),e.jsx(x,{sx:{maxHeight:"50vh",overflowY:"auto",border:"1px solid #eee",borderRadius:2,background:"#fff",boxShadow:4},children:e.jsxs(ve,{size:"small",children:[e.jsx(Pe,{children:e.jsxs(Y,{children:[e.jsx(v,{sx:{fontWeight:"bold",background:"#f8f9fa"},children:"Label"}),e.jsx(v,{sx:{fontWeight:"bold",background:"#f8f9fa"},children:"Source Value"}),e.jsx(v,{sx:{fontWeight:"bold",background:"#f8f9fa"},children:"Modified Value"})]})}),e.jsx(we,{children:(()=>{const o=_s(s),f=ys(s),d=[...new Set([...o.map(u=>u.label),...f.map(u=>u.label)])],D=me(o),j=me(f);return d.map(u=>e.jsxs(Y,{children:[e.jsx(v,{sx:{fontWeight:500},children:u}),e.jsx(v,{children:D[u]??e.jsx("i",{style:{color:"#bbb"},children:"—"})}),e.jsx(v,{children:j[u]??e.jsx("i",{style:{color:"#bbb"},children:"—"})})]},u))})()})]})})]}),e.jsx(x,{sx:{mt:3},children:pe(s.capture_image)?e.jsx(x,{children:e.jsxs(x,{display:"flex",alignItems:"center",gap:2,sx:{mb:1},children:[e.jsx(c,{sx:{fontWeight:600},children:"Capture Image"}),e.jsx(Me,{href:pe(s.capture_image),target:"_blank",rel:"noopener noreferrer",underline:"hover",sx:{fontWeight:500,fontSize:15},children:"Open Full Image"})]})}):e.jsxs(c,{sx:{color:"#bbb",fontWeight:600},children:["Capture Image: ",e.jsx("span",{style:{fontWeight:400},children:"No image"})]})})]}),e.jsx(x,{sx:{mt:2},children:s.remarks&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[e.jsx("b",{children:"Remarks:"})," "]}),e.jsx(ee,{sx:{boxShadow:3,padding:1},style:{maxHeight:"80px",overflowY:"auto"},children:s.remarks})]})})]}),e.jsx(M,{variant:"contained",fullWidth:!0,sx:{mt:3,fontWeight:600,letterSpacing:1},onClick:n,children:"Close"})]})})},{RangePicker:ks}=gs,Ds=["s_no","dispute_id","licence_type","template_name","work_flow_name","created_by_name","pending_at","dispute_status","action"],Cs=[{key:"s_no",label:"S.No"},{key:"dispute_id",label:"ID"},{key:"created_by_id",label:"Created By (ID)"},{key:"created_by_name",label:"Created By"},{key:"dispute_date",label:"Date"},{key:"template_name",label:"Template"},{key:"work_flow_name",label:"Workflow"},{key:"licence_type",label:"License"},{key:"priority",label:"Priority"},{key:"severity",label:"Severity"},{key:"description",label:"Description"},{key:"pending_at",label:"Pending At"},{key:"action",label:"Actions"}];function vs(){const r=te.getJson("userData"),[n,s]=a.useState(0),[l,m]=a.useState([]),[W,o]=a.useState({}),[f,d]=a.useState([B().startOf("month"),B().endOf("month")]),[D,j]=a.useState(0),[u,I]=a.useState(10),[P,C]=a.useState([]),[b,p]=a.useState(0),[$,E]=a.useState(10),T=[{key:"dispute_id",label:"Dispute Id"},{key:"licence_type",label:"Licence Type"},{key:"template_name",label:"Template Name"},{key:"work_flow_name",label:"Work Flow Name"},{key:"created_by_name",label:"Created By"},{key:"pending_at",label:"Pending At"},{key:"dispute_status",label:"Status"},{key:"action",label:"Action"}],[V,S]=a.useState(!1),[R,k]=a.useState(null),[ne,re]=a.useState(null),[ae,ie]=a.useState(null),[We,oe]=a.useState(!1),[Ie,G]=a.useState(!1),[Oe,J]=a.useState(!1),[Te,Ae]=a.useState(null),[Le,ze]=a.useState(null),[Fe,Ne]=a.useState(null),[A,Ee]=a.useState(null);a.useEffect(()=>{if(n!==0)return;const t={user_id:r.user_id,org_code:r.organization,type:1,from:f[0].format("YYYY-MM-DD"),to:f[1].format("YYYY-MM-DD"),role_id:r.role};z(F.auth.getDisputeList,"POST",t).then(i=>{i.status&&m(i.data||[])}).catch(()=>{m([])})},[n,f]),a.useEffect(()=>{if(n!==1)return;const t={user_id:r.user_id,org_code:r.organization};z(F.auth.getPendingDisputesList,"POST",t).then(i=>{C(i.data||[])}).catch(()=>{C([])})},[n]);const le=async()=>{const t={user_id:r.user_id,org_code:r.organization};try{const i=await z(F.auth.getPendingDisputesList,"POST",t);C(i.data||[])}catch{C([])}},Re=(t,i)=>{s(i),j(0),p(0)},ce=l.filter(t=>Object.entries(W).every(([i,h])=>!h||(t[i]||"").toString().toLowerCase().includes(h.toLowerCase()))),Ue=t=>{k(t),S(!0)},Be=()=>{k(null),S(!1)},Ye=(t,i)=>{re(t.currentTarget),ie(i),Ae(i.dispute_id),ze(i.work_flow_id),Ne(i.node_id)},de=()=>{re(null),ie(null)},q=t=>{ae&&(t==="view"&&(Ee(ae),oe(!0)),t==="resolve"&&G(!0),t==="dedicate"&&J(!0),de())},He=(t,i)=>j(i),$e=t=>{I(+t.target.value),j(0)},Ve=(t,i)=>p(i),Ge=t=>{E(+t.target.value),p(0)},Je=t=>{t&&t[0]&&t[1]&&d([B(t[0]),B(t[1])])},qe=(t,i)=>{if(t==="priority")return i==="high"?"error":i==="medium"?"warning":"info";if(t==="severity")return i==="major"||i==="critical"?"error":"info";if(t==="dispute_status"){const h=(i||"").toLowerCase();return h==="raised"?"warning":h==="resolved"||h==="approved"?"success":h==="rejected"?"error":"default"}return"default"},ue=({data:t,columns:i,page:h,rowsPerPage:_,onPageChange:Ke,onRowsPerPageChange:Ze,isPending:K=!1})=>{const he=K?i:i.filter(g=>Ds.includes(g.key)),Qe=K?t.slice(h*_,h*_+_):ce.slice(h*_,h*_+_);return e.jsxs(ee,{sx:{mt:2,boxShadow:3},children:[e.jsx(is,{children:e.jsxs(ve,{size:"small",children:[e.jsx(Pe,{children:e.jsx(Y,{children:he.map(g=>e.jsx(v,{children:!K&&["template_name","work_flow_name","licence_type"].includes(g.key)?e.jsx(be,{placeholder:`Filter ${g.label}`,variant:"standard",fullWidth:!0,onChange:U=>o(y=>({...y,[g.key]:U.target.value}))}):g.label},g.key))})}),e.jsx(we,{children:Qe.map((g,U)=>e.jsx(Y,{children:he.map(y=>e.jsx(v,{children:y.key==="s_no"?h*_+U+1:y.key==="action"?e.jsx(H,{onClick:L=>Ye(L,g),children:e.jsx(os,{})}):y.key==="dispute_id"?e.jsx(Me,{component:"button",underline:"hover",color:"primary",onClick:()=>Ue(g),children:e.jsx("strong",{children:g.dispute_id})}):["priority","severity","dispute_status"].includes(y.key)?(()=>{const L=g[y.key];return L?e.jsx(X,{label:L,color:qe(y.key,L),size:"small",sx:{textTransform:"capitalize",fontWeight:600,color:"#fff"}}):"--"})():g[y.key]??"--"},y.key))},g.dispute_id??U))})]})}),e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,children:[e.jsx(c,{variant:"body2",children:t.length>0?`Showing ${h*_+1}–${Math.min((h+1)*_,t.length)} of ${t.length}`:"No records found"}),e.jsx(ls,{component:"div",count:t.length,page:h,rowsPerPage:_,onPageChange:Ke,onRowsPerPageChange:Ze,rowsPerPageOptions:[10,20,30,40]})]})]})};return e.jsxs(x,{sx:{px:3,py:2,minHeight:"100vh"},children:[e.jsx(Ce,{spacing:1,children:e.jsxs(ts,{separator:"›",children:[e.jsx(ns,{to:"/home",children:"Home"}),e.jsx(c,{color:"text.primary",children:"Disputes"})]})}),e.jsx(x,{sx:{mt:2},children:e.jsxs(rs,{value:n,onChange:Re,children:[e.jsx(xe,{label:"All/Raised Disputes"}),e.jsx(xe,{label:"Pending Disputes"})]})}),n===0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{sx:{mt:2,p:2,boxShadow:3},children:e.jsx(ks,{value:f,onChange:Je})}),ue({data:ce,columns:T,page:D,rowsPerPage:u,onPageChange:He,onRowsPerPageChange:$e})]}),n===1&&ue({data:P,columns:Cs,page:b,rowsPerPage:$,onPageChange:Ve,onRowsPerPageChange:Ge,isPending:!0}),e.jsxs(as,{anchorEl:ne,open:!!ne,onClose:de,children:[n===0&&e.jsx(O,{onClick:()=>q("view"),children:"View Dispute"}),n===1&&e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:()=>q("resolve"),children:"Resolve Dispute"}),e.jsx(O,{onClick:()=>q("dedicate"),children:"Delegation"})]})]}),e.jsx(ps,{open:We,onClose:()=>oe(!1),history:(A==null?void 0:A.history)||[],rowData:A}),e.jsx(fs,{open:Ie,onClose:()=>G(!1),onSave:()=>{G(!1),le()},getDisputID:Te,getWorkFlowID:Le,getNodeID:Fe,rowData:A}),e.jsx(js,{open:Oe,onClose:()=>J(!1),onSave:()=>{J(!1),le()},users:[],selectedRows:[],rowData:{}}),e.jsx(Ss,{open:V,onClose:Be,drawerRowData:R,columns:T})]})}const Ps={title:`Disputes - ${ds.site.name}`};function Is(){return e.jsxs(e.Fragment,{children:[e.jsx(cs,{children:e.jsxs("title",{children:[" ",Ps.title]})}),e.jsx(vs,{})]})}export{Is as default};
